# Скрипт для локального тестирования Flask приложения
# Запускает сервер, выполняет тесты и корректно завершает процессы

# Установка дополнительных зависимостей для обработки изображений
# Эти пакеты необходимы для функциональности устранения шума
pip3 install opencv-python-headless numpy matplotlib scikit-image

# Запуск Flask приложения через Gunicorn WSGI сервер
gunicorn --bind 127.0.0.1:5000 wsgi:app & APP_PID=$!

# Ожидание полного запуска приложения
sleep 25
# Запуск тестового клиента для проверки функциональности
python3 client.py
# Сохранение кода возврата тестов для последующего использования
APP_CODE=$?

# Короткая пауза перед завершением чтобы убедиться что все запросы обработаны
sleep 5
# Корректное завершение Gunicorn процесса
kill -TERM $APP_PID

# Вывод кода возврата тестов для диагностики
echo "Application exit code: $APP_CODE"
# Выход с кодом возврата тестового клиента
exit $APP_CODE
